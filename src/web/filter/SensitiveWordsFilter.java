package web.filter;import javax.servlet.*;import javax.servlet.annotation.WebFilter;import java.io.*;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;import java.util.ArrayList;import java.util.HashMap;import java.util.List;import java.util.Map;@WebFilter(filterName = "Filter2",value = "/*")public class SensitiveWordsFilter implements Filter {    public void destroy() {    }    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws ServletException, IOException {        ServletRequest proxy_req = (ServletRequest) Proxy.newProxyInstance(req.getClass().getClassLoader(),                req.getClass().getInterfaces(),                new InvocationHandler() {                    @Override                    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {                        //增强getParameter方法                        //判断是否是getParameter方法                        if(method.getName().equals("getParameter")){                            //增强返回值                            //获取返回值                            String value = (String) method.invoke(req,args);                            if(value != null){                                for(String str : list){                                    if(value.contains(str)){                                        value = value.replaceAll(str,"**");                                    }                                }                            }                            return value;                        }                        if (method.getName().equals("getParameterMap")) {                            Map<String, String[]> map = (Map<String, String[]>) method.invoke(req, args);                            Map<String, String[]> stringMap = null;                            if (map != null) {                                stringMap = new HashMap<>();                                for (String key : map.keySet()) {                                    //str为一个String                                    String[] strings = map.get(key);                                    if (strings != null) {                                        //调用方法 查找字符串数组中的敏感词汇                                        for(String str : list){                                            if(strings[0].contains(str)){                                                strings[0] = strings[0].replaceAll(str,"**");                                            }                                        }                                    }                                    stringMap.put(key, strings);                                }                            }                            return stringMap;                        }                        return method.invoke(req,args);                    }                });        chain.doFilter(proxy_req, resp);    }    private List<String> list = new ArrayList<String>();//敏感词汇集合    public void init(FilterConfig config) throws ServletException {        try {            ServletContext sc = config.getServletContext();            String realPath = sc.getRealPath("/WEB-INF/classes/SensitiveWords.txt");            InputStreamReader fReader = new InputStreamReader(new FileInputStream(realPath),"UTF-8");            BufferedReader br = new BufferedReader(fReader);            String line = null;            while ((line = br.readLine()) != null){                list.add(line);            }            br.close();        } catch (IOException e) {            e.printStackTrace();        }    }}